# TanmiWorkspace 配置指南

本文档指导你在 git clone 项目后如何配置和使用 TanmiWorkspace。

## 前置要求

- **Node.js**: 20.19+ 或 22.12+（推荐使用 nvm 管理版本）
- **Claude Code CLI** 或 **Cursor**

检查 Node.js 版本：
```bash
node --version
```

## 快速开始

### 1. 克隆并构建

```bash
# 克隆项目
git clone https://github.com/your-repo/tanmi-workspace.git
cd tanmi-workspace

# 安装依赖
npm install

# 构建项目
npm run build
```

### 2. 配置 Claude Code（推荐）

#### 步骤一：添加 MCP 权限

运行配置脚本，自动添加 MCP 权限到项目本地配置：

```bash
./scripts/setup-claude-code.sh
```

脚本会在项目目录下创建或更新 `.claude/settings.local.json`，添加所有需要的 MCP 工具权限（会保留已有权限）。

#### 步骤二：添加 MCP 服务器

编辑 Claude Code 全局配置文件 `~/.claude/settings.json`，在 `mcpServers` 中添加：

```json
{
  "mcpServers": {
    "tanmi-workspace": {
      "command": "node",
      "args": ["/path/to/tanmi-workspace/dist/index.js"],
      "env": {
        "TANMI_PROJECT_ROOT": "/path/to/tanmi-workspace"
      }
    }
  }
}
```

将 `/path/to/tanmi-workspace` 替换为实际的项目路径。

#### 步骤三：启动 Claude Code

在项目目录下启动 Claude Code：

```bash
claude
```

### 3. 配置 Cursor（可选）

如果使用 Cursor，需要手动配置 MCP 服务器。

编辑 Cursor 的 MCP 配置文件，添加：

```json
{
  "mcpServers": {
    "tanmi-workspace": {
      "command": "node",
      "args": ["/path/to/tanmi-workspace/dist/index.js"],
      "env": {
        "TANMI_PROJECT_ROOT": "/path/to/tanmi-workspace"
      }
    }
  }
}
```

将 `/path/to/tanmi-workspace` 替换为实际的项目路径。

### 4. 启动 Web 界面（可选）

Web 界面提供可视化的工作区管理：

```bash
npm run start:http
```

访问 http://localhost:3001 查看工作区状态。

## 验证安装

在 Claude Code 或 Cursor 中输入以下命令验证：

```
调用 tanmi_help(topic="overview") 获取系统概述
```

如果返回 TanmiWorkspace 的介绍信息，说明配置成功。

## 环境变量

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `TANMI_PROJECT_ROOT` | 工作区数据存储路径 | 当前工作目录 |
| `TANMI_PORT` | Web 服务端口 | 3001 |
| `TANMI_HOST` | Web 服务监听地址 | 127.0.0.1 |

## 常见问题

### MCP 服务未启动

确保已运行 `npm run build` 构建项目，且 `dist/index.js` 文件存在。

### 端口被占用

如果 3001 端口被占用，可以设置环境变量更换端口：

```bash
TANMI_PORT=3002 npm run start:http
```

### Node.js 版本不兼容

使用 nvm 切换到兼容版本：

```bash
nvm install 22
nvm use 22
```

### 权限不足

如果脚本无法执行，添加执行权限：

```bash
chmod +x ./scripts/setup-claude-code.sh
```

### jq 未安装

配置脚本使用 `jq` 来合并 JSON 配置。如果未安装 `jq`，脚本会使用简单模式，但推荐安装：

```bash
# macOS
brew install jq

# Ubuntu/Debian
sudo apt-get install jq
```

## 下一步

配置完成后，可以：

1. 运行 `tanmi_help(topic="start")` 了解如何开始新任务
2. 运行 `tanmi_help(topic="workflow")` 了解工作流程
3. 访问 Web 界面查看工作区可视化
