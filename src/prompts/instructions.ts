// src/prompts/instructions.ts
// TanmiWorkspace AI Instructions - æä¾›ç»™ AI çš„å®Œæ•´ä½¿ç”¨æŒ‡å—

/**
 * ç³»ç»Ÿæ¦‚è¿° - AI é¦–æ¬¡è¿æ¥æ—¶åº”è·å–çš„æ ¸å¿ƒä¿¡æ¯
 */
export const SYSTEM_OVERVIEW = `
# TanmiWorkspace ä½¿ç”¨æŒ‡å—

## è¿™æ˜¯ä»€ä¹ˆï¼Ÿ
TanmiWorkspace æ˜¯ä¸€ä¸ª**åˆ†å½¢ä»»åŠ¡è·Ÿè¸ªç³»ç»Ÿ**ï¼Œå¸®åŠ©ä½ ï¼ˆAIï¼‰å’Œç”¨æˆ·ä¸€èµ·ç®¡ç†å¤æ‚çš„å¼€å‘ä»»åŠ¡ã€‚
å®ƒé€šè¿‡æ ‘çŠ¶ç»“æ„ç»„ç»‡ä»»åŠ¡ï¼Œæ”¯æŒä»»åŠ¡çš„æ— é™åµŒå¥—ã€çŠ¶æ€è¿½è¸ªã€ä¸Šä¸‹æ–‡éš”ç¦»ã€‚

## æ ¸å¿ƒä»·å€¼
- **åˆ†å½¢ç»“æ„**ï¼šä»»ä½•æ­¥éª¤éƒ½å¯ä»¥å‡çº§ä¸ºç‹¬ç«‹å­ä»»åŠ¡
- **èšç„¦ä¸Šä¸‹æ–‡**ï¼šæ‰§è¡Œç‰¹å®šèŠ‚ç‚¹æ—¶è‡ªåŠ¨è¿‡æ»¤æ— å…³ä¿¡æ¯
- **è¿‡ç¨‹å¯è¿½æº¯**ï¼šå®Œæ•´è®°å½•æ“ä½œå†å²ï¼Œæ”¯æŒå›æº¯å¤ç›˜
- **åŠ¨æ€ç®¡ç†**ï¼šæ”¯æŒä»»åŠ¡åˆ†è£‚ã€å¼•ç”¨ã€éš”ç¦»ç­‰é«˜çº§æ“ä½œ
- **å¯è§†åŒ–ç•Œé¢**ï¼šæä¾› Web UI æŸ¥çœ‹ä»»åŠ¡è¿›åº¦å’ŒèŠ‚ç‚¹è¯¦æƒ…

## Web UI
TanmiWorkspace æä¾›å¯è§†åŒ– Web ç•Œé¢ã€‚æ‰€æœ‰ workspace ç›¸å…³çš„å·¥å…·è¿”å›å€¼éƒ½åŒ…å« \`webUrl\` å­—æ®µã€‚

**ç«¯å£è§„åˆ™**ï¼š
- æ­£å¼ç¯å¢ƒï¼š\`http://localhost:3000/workspace/{workspaceId}\`
- å¼€å‘ç¯å¢ƒï¼ˆTANMI_DEV=trueï¼‰ï¼š\`http://localhost:3001/workspace/{workspaceId}\`

**å½“ç”¨æˆ·æƒ³è¦å¯è§†åŒ–æŸ¥çœ‹æ—¶ï¼Œç›´æ¥æä¾›è¿”å›çš„ webUrl è®©ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚**

## ä½ çš„è§’è‰²
ä½œä¸º AI åŠ©æ‰‹ï¼Œä½ åº”è¯¥ï¼š
1. **ä¸»åŠ¨æ¨è¿›**ï¼šå‡å°‘ä¸å¿…è¦çš„è¯¢é—®ï¼Œæœ‰æ˜ç¡®å‚è€ƒæ—¶ç›´æ¥æ‰§è¡Œ
2. **è®°å½•è¿‡ç¨‹**ï¼šæ¯ä¸ªå…³é”®åŠ¨ä½œéƒ½è¿½åŠ æ—¥å¿—
3. **å¼•å¯¼ç”¨æˆ·**ï¼šå½“ç”¨æˆ·ä¸ç†Ÿæ‚‰æµç¨‹æ—¶ï¼Œä¸»åŠ¨è§£é‡Šå¹¶å¼•å¯¼
4. **ä¿æŒèšç„¦**ï¼šä½¿ç”¨ context_focus ä¿æŒåœ¨æ­£ç¡®çš„ä»»åŠ¡ä¸Šä¸‹æ–‡ä¸­
`;

/**
 * æ ¸å¿ƒå·¥ä½œæµç¨‹
 */
export const CORE_WORKFLOW = `
## æ ¸å¿ƒå·¥ä½œæµç¨‹

### 1. åˆ›å»ºå·¥ä½œåŒºæµç¨‹
\`\`\`
ç”¨æˆ·æå‡ºä»»åŠ¡
    â†“
è‡ªåŠ¨æ‰«æé¡¹ç›®ï¼ˆ./Doc/, ./docs/, ./RULE/, ./README.mdï¼‰
    â†“
æ™ºèƒ½åŒ¹é…ç›¸å…³æ–‡æ¡£å’Œè§„èŒƒ
    â†“
å‘ç”¨æˆ·ç¡®è®¤ï¼šç›®æ ‡ã€è§„åˆ™ã€æ–‡æ¡£å¼•ç”¨
    â†“
è°ƒç”¨ workspace_init åˆ›å»ºå·¥ä½œåŒº
    â†“
â˜… å‘ŠçŸ¥ç”¨æˆ· webUrlï¼ˆå¯è§†åŒ–ç•Œé¢åœ°å€ï¼‰
    â†“
æ ¹æ®ä»»åŠ¡ç±»å‹åˆ¶å®šè®¡åˆ’ï¼Œåˆ›å»ºå­èŠ‚ç‚¹
\`\`\`

### 2. èŠ‚ç‚¹æ‰§è¡Œæµç¨‹

**âš ï¸ é‡è¦ï¼šæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»ä¸¥æ ¼éµå¾ªæ­¤æµç¨‹ï¼Œä¸å¯è·³æ­¥ï¼**

\`\`\`
â˜… ç¬¬ä¸€æ­¥å¿…é¡»æ˜¯ startï¼
è°ƒç”¨ node_transition(action="start") è¿›å…¥ implementing çŠ¶æ€
ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨å°†çˆ¶èŠ‚ç‚¹é“¾ä¹Ÿè®¾ä¸º implementingï¼‰
    â†“
è‡ªæŸ¥å¼•ç”¨ï¼šæ£€æŸ¥æ–‡æ¡£å¼•ç”¨æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™è¡¥å……
    â†“
æ‰§è¡Œ + æ—¥å¿—ï¼šlog_append è®°å½•å…³é”®åŠ¨ä½œ
    â†“
â˜… é˜¶æ®µæ€§ç»“è®ºï¼šæ¯å½¢æˆä¸€ä¸ªç»“è®ºï¼Œç«‹å³ node_update è®°å½•åˆ° note
    â†“
åˆ¤æ–­æ˜¯å¦åˆ†è£‚ï¼š
  - åˆ†ææ·±åº¦ > 3 æ­¥ â†’ åˆ†è£‚
  - æœ‰æ–°æ–¹å‘è¦æ¢ç´¢ â†’ åˆ†è£‚
  - ç»“è®ºæ˜ç¡®ä½†éœ€ç»§ç»­ â†’ åˆ†è£‚
    â†“
é‡é˜»å¤„ç†ï¼šproblem_update è®°å½•é—®é¢˜
    â†“
â˜… æœ€ç»ˆç»“è®ºï¼šnode_transition(action="complete", conclusion="...")
\`\`\`

**ç¦æ­¢è·³æ­¥è¡Œä¸º**ï¼š
- âŒ æœª start å°±ç›´æ¥ complete
- âŒ åœ¨æ‰§è¡ŒèŠ‚ç‚¹ A æ—¶é¡ºä¾¿å®ŒæˆèŠ‚ç‚¹ B
- âŒ æ‰¹é‡å°†å¤šä¸ªèŠ‚ç‚¹æ ‡è®°ä¸º completed

### 2.1 ç»“è®ºè®°å½•åŸåˆ™ï¼ˆé‡è¦ï¼ï¼‰

**æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»æœ‰ç»“è®º**ï¼šèŠ‚ç‚¹å®Œæˆæ—¶ï¼Œconclusion å­—æ®µå¿…é¡»åŒ…å«æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚

| èŠ‚ç‚¹ç±»å‹ | ç»“è®ºåº”åŒ…å« |
|----------|-----------|
| åˆ†æç±» | åˆ†æç»“æœã€å‘ç°çš„é—®é¢˜ã€æ ¹å›  |
| å®ç°ç±» | å®é™…é‡‡ç”¨çš„æ–¹æ¡ˆã€å…³é”®ä¿®æ”¹ç‚¹ |
| éªŒè¯ç±» | éªŒè¯ç»“æœã€é€šè¿‡/å¤±è´¥åŸå›  |
| è°ƒè¯•ç±» | Bug åŸå› ã€ä¿®å¤æ–¹æ³• |

**ä¸­é—´è¿‡ç¨‹ä¹Ÿè¦è®°å½•**ï¼š
- ä½¿ç”¨ \`node_update({ note: "..." })\` è®°å½•åˆ†æä¸­çš„é˜¶æ®µæ€§ç»“è®º
- åˆ†è£‚å­èŠ‚ç‚¹å‰ï¼Œå…ˆåœ¨çˆ¶èŠ‚ç‚¹è®°å½•"æˆªè‡³ç›®å‰çš„å‘ç°"
- è¿™æ ·å³ä½¿åç»­åˆ†æå¤±è´¥ï¼Œä¹‹å‰çš„ç»“è®ºä¹Ÿä¸ä¼šä¸¢å¤±

### 3. çŠ¶æ€æµè½¬è§„åˆ™
\`\`\`
pending â”€â”€startâ”€â”€â†’ implementing â”€â”€submitâ”€â”€â†’ validating â”€â”€passâ”€â”€â†’ completed
                        â”‚                       â”‚                     â”‚
                        â”‚ complete              â”‚ fail                â”‚ reopen
                        â†“                       â†“                     â†“
                    completed                 failed â”€â”€retryâ”€â”€â†’ implementing
\`\`\`

**è‡ªåŠ¨çº§è”è§„åˆ™**ï¼š
- å½“å­èŠ‚ç‚¹ start æ—¶ï¼Œçˆ¶èŠ‚ç‚¹é“¾è‡ªåŠ¨ä» pending â†’ implementing
- å½“å­èŠ‚ç‚¹ reopen æ—¶ï¼Œå·²å®Œæˆçš„çˆ¶èŠ‚ç‚¹é“¾ä¹Ÿä¼šè‡ªåŠ¨ reopen

**é‡æ–°æ¿€æ´»èŠ‚ç‚¹**ï¼š
- å¯¹äºå·²å®Œæˆçš„èŠ‚ç‚¹ï¼Œå¦‚éœ€æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½¿ç”¨ \`node_transition(action="reopen")\`
- reopen ä¼šè‡ªåŠ¨çº§è”æ¿€æ´»å·²å®Œæˆçš„çˆ¶èŠ‚ç‚¹

### 4. èŠ‚ç‚¹åˆ†è£‚æ—¶æœºï¼ˆé‡è¦ï¼ï¼‰

**åŸåˆ™ï¼šåˆ†ææ·±åº¦è¶…è¿‡ 3 å±‚æ—¶å¿…é¡»åˆ†è£‚èŠ‚ç‚¹**

| åœºæ™¯ | å¤„ç†æ–¹å¼ | ç¤ºä¾‹ |
|------|----------|------|
| çº¿æ€§è¿½æŸ¥ä»£ç ï¼ˆâ‰¤3æ­¥ï¼‰ | ä»…è®°å½•æ—¥å¿— | æŸ¥çœ‹å‡½æ•° â†’ æ‰¾åˆ°è°ƒç”¨å¤„ â†’ å®šä½é—®é¢˜ |
| çº¿æ€§è¿½æŸ¥ä»£ç ï¼ˆ>3æ­¥ï¼‰ | **å¿…é¡»åˆ†è£‚** | è¿½æŸ¥è·¯å¾„è¿‡é•¿ï¼Œåˆ›å»º"è¿½æŸ¥ XXX"å­èŠ‚ç‚¹ |
| å½¢æˆå‡è®¾éœ€éªŒè¯ | **ç«‹å³åˆ†è£‚** | åˆ›å»º"éªŒè¯å‡è®¾ï¼šXXX"å­èŠ‚ç‚¹ |
| å‡ºç°åˆ†æ”¯è·¯å¾„ | **ç«‹å³åˆ†è£‚** | åˆ›å»ºå¹³çº§å­èŠ‚ç‚¹ï¼Œæ¯æ¡è·¯å¾„ä¸€ä¸ª |
| éœ€è¦æ”¹ä»£ç éªŒè¯ | **å¿…é¡»åˆ†è£‚** | ä»£ç ä¿®æ”¹å¿…é¡»æœ‰ç‹¬ç«‹èŠ‚ç‚¹è¿½è¸ª |
| ç¡®è®¤æ ¹å› ï¼Œå¼€å§‹ä¿®å¤ | **ç«‹å³åˆ†è£‚** | åˆ›å»º"ä¿®å¤ï¼šXXX"å­èŠ‚ç‚¹ |
| åˆ†æå½¢æˆé˜¶æ®µæ€§ç»“è®º | **ç«‹å³åˆ†è£‚** | å°†ç»“è®ºè®°å½•åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå†åˆ›å»ºä¸‹ä¸€æ­¥å­èŠ‚ç‚¹ |

**è‡ªåŠ¨åˆ†è£‚è§¦å‘å™¨**ï¼ˆAI åº”ä¸»åŠ¨æ‰§è¡Œï¼Œæ— éœ€ç”¨æˆ·è¦æ±‚ï¼‰ï¼š
1. å½“ä½ å‘ç°éœ€è¦è¶…è¿‡ 3 ä¸ªæ—¥å¿—æ¡ç›®æ¥è®°å½•åˆ†æè¿‡ç¨‹æ—¶ â†’ åˆ†è£‚
2. å½“ä½ è¯´"æ¥ä¸‹æ¥éœ€è¦..."æˆ–"ä¸‹ä¸€æ­¥æ˜¯..."æ—¶ â†’ è€ƒè™‘åˆ†è£‚
3. å½“åˆ†æå½¢æˆæ˜ç¡®ç»“è®ºï¼Œä½†ä»»åŠ¡å°šæœªå®Œæˆæ—¶ â†’ è®°å½•ç»“è®ºå¹¶åˆ†è£‚
4. å½“ä½ éœ€è¦åœ¨å¤šä¸ªæ–¹å‘åŒæ—¶æ¢ç´¢æ—¶ â†’ ç«‹å³åˆ†è£‚ä¸ºå¹³çº§èŠ‚ç‚¹
`;

/**
 * å·¥å…·é€ŸæŸ¥è¡¨
 */
export const TOOLS_QUICK_REFERENCE = `
## å·¥å…·é€ŸæŸ¥è¡¨

### å·¥ä½œåŒºç®¡ç†
| å·¥å…· | ç”¨é€” | å…³é”®å‚æ•° |
|------|------|----------|
| workspace_init | åˆ›å»ºæ–°å·¥ä½œåŒº | name, goal, rules?, docs? |
| workspace_list | åˆ—å‡ºæ‰€æœ‰å·¥ä½œåŒº | status? (active/archived/all) |
| workspace_get | è·å–å·¥ä½œåŒºè¯¦æƒ… | workspaceId |
| workspace_delete | åˆ é™¤å·¥ä½œåŒº | workspaceId, force? |
| workspace_status | æ˜¾ç¤ºçŠ¶æ€æ¦‚è§ˆ | workspaceId, format? |

**é‡è¦**ï¼šworkspace_init è¿”å› \`webUrl\`ï¼ŒåŠ¡å¿…å‘ŠçŸ¥ç”¨æˆ·æ­¤åœ°å€å¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ä»»åŠ¡è¿›åº¦ã€‚

### èŠ‚ç‚¹ç®¡ç†
| å·¥å…· | ç”¨é€” | å…³é”®å‚æ•° |
|------|------|----------|
| node_create | è®¡åˆ’é˜¶æ®µåˆ›å»ºå­ä»»åŠ¡ | workspaceId, parentId, title, requirement? |
| node_split | æ‰§è¡Œä¸­åˆ†è£‚å­ä»»åŠ¡ | workspaceId, parentId, title, requirement |
| node_get | è·å–èŠ‚ç‚¹è¯¦æƒ… | workspaceId, nodeId |
| node_list | åˆ—å‡ºèŠ‚ç‚¹æ ‘ | workspaceId, rootId?, depth? |
| node_update | æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯ | workspaceId, nodeId, title?, requirement?, note? |
| node_delete | åˆ é™¤èŠ‚ç‚¹ | workspaceId, nodeId |

### çŠ¶æ€è½¬æ¢
| å·¥å…· | action å€¼ | è½¬æ¢ |
|------|-----------|------|
| node_transition | start | pending â†’ implementing |
| node_transition | submit | implementing â†’ validating |
| node_transition | complete | implementing â†’ completed |
| node_transition | pass | validating â†’ completed |
| node_transition | fail | validating â†’ failed |
| node_transition | retry | failed â†’ implementing |
| node_transition | reopen | completed â†’ implementing |

### ä¸Šä¸‹æ–‡ç®¡ç†
| å·¥å…· | ç”¨é€” | å…³é”®å‚æ•° |
|------|------|----------|
| context_get | è·å–èšç„¦ä¸Šä¸‹æ–‡ | workspaceId, nodeId, includeLog?, includeProblem? |
| context_focus | åˆ‡æ¢å½“å‰ç„¦ç‚¹ | workspaceId, nodeId |
| node_isolate | è®¾ç½®/å–æ¶ˆéš”ç¦» | workspaceId, nodeId, isolate |
| node_reference | ç®¡ç†å¼•ç”¨ | workspaceId, nodeId, targetIdOrPath, action |

### æ—¥å¿—ä¸é—®é¢˜
| å·¥å…· | ç”¨é€” | å…³é”®å‚æ•° |
|------|------|----------|
| log_append | è¿½åŠ æ—¥å¿— | workspaceId, nodeId?, operator, event |
| problem_update | æ›´æ–°é—®é¢˜ | workspaceId, nodeId?, problem, nextStep? |
| problem_clear | æ¸…é™¤é—®é¢˜ | workspaceId, nodeId? |
`;

/**
 * åœºæ™¯åŒ–æŒ‡å¯¼
 */
export const SCENARIO_GUIDES: Record<string, string> = {
  // å¼€å§‹æ–°ä»»åŠ¡
  "start_task": `
## åœºæ™¯ï¼šå¼€å§‹æ–°ä»»åŠ¡

### å½“ç”¨æˆ·è¯´"å¸®æˆ‘åš XXX"æ—¶ï¼š

**æ­¥éª¤ 1ï¼šæ”¶é›†ä¿¡æ¯**
\`\`\`
å‘ç”¨æˆ·ç¡®è®¤ï¼š
1. ä»»åŠ¡ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆç®€æ˜æè¿°ï¼‰
2. æœ‰å“ªäº›ç›¸å…³çš„æ–‡æ¡£æˆ–è§„èŒƒéœ€è¦éµå¾ªï¼Ÿ
3. è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„ä»»åŠ¡ï¼Ÿï¼ˆéœ€æ±‚å¼€å‘/Bugä¿®å¤/é‡æ„/æ€»ç»“ï¼‰
\`\`\`

**æ­¥éª¤ 2ï¼šåˆ›å»ºå·¥ä½œåŒº**
\`\`\`typescript
// è°ƒç”¨ç¤ºä¾‹
workspace_init({
  name: "å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½",
  goal: "ä¸ºåº”ç”¨æ·»åŠ ç”¨æˆ·åå¯†ç ç™»å½•åŠŸèƒ½ï¼ŒåŒ…æ‹¬å‰ç«¯è¡¨å•å’Œåç«¯éªŒè¯",
  rules: ["./RULE/coding_standard.md"],
  docs: [
    { path: "./Doc/APIè®¾è®¡.md", description: "åç«¯ API è§„èŒƒ" },
    { path: "./src/auth/", description: "ç°æœ‰è®¤è¯æ¨¡å—" }
  ]
})
\`\`\`

**æ­¥éª¤ 2.5ï¼šå‘ŠçŸ¥ç”¨æˆ· Web UI åœ°å€**
workspace_init è¿”å›çš„ \`webUrl\` æ˜¯å¯è§†åŒ–ç•Œé¢åœ°å€ï¼Œ**åŠ¡å¿…å‘ŠçŸ¥ç”¨æˆ·**ï¼š
> "å·¥ä½œåŒºå·²åˆ›å»ºï¼ä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ­¤åœ°å€æŸ¥çœ‹è¿›åº¦ï¼š
> [webUrl çš„å€¼ï¼Œä¾‹å¦‚ http://localhost:5173/workspace/ws-xxx]"

**æ­¥éª¤ 3ï¼šåˆ¶å®šè®¡åˆ’**
æ ¹æ®ä»»åŠ¡ç±»å‹ï¼Œåˆ›å»ºå­èŠ‚ç‚¹åˆ†è§£ä»»åŠ¡ã€‚

**å¼•å¯¼è¯æœ¯**ï¼š
> "å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ ç®¡ç†è¿™ä¸ªä»»åŠ¡ã€‚é¦–å…ˆè®©æˆ‘ç¡®è®¤å‡ ä¸ªé—®é¢˜ï¼š
> 1. è¿™ä¸ªä»»åŠ¡çš„å…·ä½“ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ
> 2. æœ‰æ²¡æœ‰éœ€è¦éµå¾ªçš„é¡¹ç›®è§„èŒƒæˆ–å‚è€ƒæ–‡æ¡£ï¼Ÿ
> æˆ‘ä¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œåŒºæ¥è·Ÿè¸ªæ•´ä¸ªè¿‡ç¨‹ã€‚"
`,

  // ç»§ç»­ä»»åŠ¡
  "resume_task": `
## åœºæ™¯ï¼šç»§ç»­ä¹‹å‰çš„ä»»åŠ¡

### å½“ç”¨æˆ·è¯´"ç»§ç»­ä¹‹å‰çš„ä»»åŠ¡"æ—¶ï¼š

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹å·¥ä½œåŒºåˆ—è¡¨**
\`\`\`typescript
workspace_list({ status: "active" })
\`\`\`

**æ­¥éª¤ 2ï¼šå¦‚æœæœ‰å¤šä¸ªï¼Œè®©ç”¨æˆ·é€‰æ‹©**

**æ­¥éª¤ 3ï¼šè·å–å·¥ä½œåŒºçŠ¶æ€**
\`\`\`typescript
workspace_status({ workspaceId: "xxx", format: "markdown" })
\`\`\`

**æ­¥éª¤ 4ï¼šæ‰¾åˆ°å½“å‰ç„¦ç‚¹æˆ–æœ€è¿‘æ´»è·ƒçš„èŠ‚ç‚¹**
\`\`\`typescript
context_get({ workspaceId: "xxx", nodeId: "current-focus", includeLog: true })
\`\`\`

**æ­¥éª¤ 5ï¼šæ¢å¤æ‰§è¡Œ**

**å¼•å¯¼è¯æœ¯**ï¼š
> "è®©æˆ‘çœ‹çœ‹ä¹‹å‰çš„è¿›åº¦..."
> "æ‰¾åˆ°äº†ï¼Œä¸Šæ¬¡æˆ‘ä»¬åœ¨å¤„ç† [èŠ‚ç‚¹åç§°]ï¼Œå½“å‰çŠ¶æ€æ˜¯ [çŠ¶æ€]ã€‚"
> "ä¸Šæ¬¡è®°å½•çš„é—®é¢˜æ˜¯ï¼š[é—®é¢˜å†…å®¹]"
> "æˆ‘ä»¬ç»§ç»­å—ï¼Ÿ"
`,

  // ä»»åŠ¡å—é˜»
  "task_blocked": `
## åœºæ™¯ï¼šä»»åŠ¡é‡åˆ°é—®é¢˜

### å½“æ‰§è¡Œä¸­é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜æ—¶ï¼š

**æ­¥éª¤ 1ï¼šè®°å½•é—®é¢˜**
\`\`\`typescript
problem_update({
  workspaceId: "xxx",
  nodeId: "current-node",
  problem: "æ— æ³•æ‰¾åˆ° ModuleFactory çš„å®šä¹‰ï¼Œå¯èƒ½éœ€è¦å…ˆé…ç½®å¼€å‘ç¯å¢ƒ",
  nextStep: "éœ€è¦ç”¨æˆ·ç¡®è®¤é¡¹ç›®ä¾èµ–æ˜¯å¦å·²å®‰è£…"
})
\`\`\`

**æ­¥éª¤ 2ï¼šè®°å½•æ—¥å¿—**
\`\`\`typescript
log_append({
  workspaceId: "xxx",
  nodeId: "current-node",
  operator: "AI",
  event: "æ‰§è¡Œå—é˜»ï¼šç¼ºå°‘ ModuleFactory å®šä¹‰ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤"
})
\`\`\`

**æ­¥éª¤ 3ï¼šå‘ç”¨æˆ·æŠ¥å‘Š**

**å¼•å¯¼è¯æœ¯**ï¼š
> "åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š[é—®é¢˜æè¿°]
>
> æˆ‘çš„å»ºè®®æ˜¯ï¼š[ä¸‹ä¸€æ­¥å»ºè®®]
>
> éœ€è¦ä½ ç¡®è®¤ï¼š[éœ€è¦ç”¨æˆ·æä¾›çš„ä¿¡æ¯]
>
> è¿™ä¸ªé—®é¢˜å·²ç»è®°å½•åœ¨ä»»åŠ¡ä¸­ï¼Œç­‰è§£å†³åæˆ‘ä»¬å¯ä»¥ç»§ç»­ã€‚"
`,

  // åˆ†è£‚ä»»åŠ¡
  "split_task": `
## åœºæ™¯ï¼šéœ€è¦åˆ†è£‚ä»»åŠ¡

### è‡ªåŠ¨åˆ†è£‚è§¦å‘æ¡ä»¶ï¼ˆæ— éœ€ç”¨æˆ·è¦æ±‚ï¼‰ï¼š

| æ¡ä»¶ | å¿…é¡»åˆ†è£‚ |
|------|---------|
| åˆ†ææ­¥éª¤ > 3 æ­¥ | âœ… |
| å½¢æˆé˜¶æ®µæ€§ç»“è®º | âœ… |
| éœ€è¦éªŒè¯å‡è®¾ | âœ… |
| å‡ºç°å¤šæ¡è·¯å¾„ | âœ… |
| éœ€è¦æ”¹ä»£ç éªŒè¯ | âœ… |
| å‘ç°å‰ç½®ä¾èµ– | âœ… |

### åˆ†è£‚æµç¨‹ï¼ˆä¸‰æ­¥æ³•ï¼‰ï¼š

**æ­¥éª¤ 1ï¼šå…ˆè®°å½•å½“å‰ç»“è®ºï¼ˆå…³é”®ï¼ï¼‰**
\`\`\`typescript
// åœ¨åˆ†è£‚å‰ï¼Œå…ˆæŠŠå½“å‰å‘ç°è®°å½•åˆ°çˆ¶èŠ‚ç‚¹
node_update({
  workspaceId: "xxx",
  nodeId: "current-node",
  note: "åˆ†æå‘ç°ï¼šé—®é¢˜å‡ºåœ¨ UserModule çš„ç±»å‹å®šä¹‰ç¼ºå¤±ã€‚éœ€è¦åˆ›å»ºç±»å‹æ–‡ä»¶åæ‰èƒ½ç»§ç»­ã€‚"
})
\`\`\`

**æ­¥éª¤ 2ï¼šåˆ†è£‚èŠ‚ç‚¹**
\`\`\`typescript
node_split({
  workspaceId: "xxx",
  parentId: "current-node",
  title: "æ·»åŠ ç±»å‹å®šä¹‰æ–‡ä»¶",
  requirement: "ä¸º UserModule åˆ›å»º TypeScript ç±»å‹å®šä¹‰",
  inheritContext: true
})
\`\`\`

**æ­¥éª¤ 3ï¼šç»§ç»­æ‰§è¡Œæ–°èŠ‚ç‚¹**

### ç¤ºä¾‹ï¼šåˆ†æè¿‡ç¨‹ä¸­çš„ä¸»åŠ¨åˆ†è£‚

\`\`\`
[å¼€å§‹åˆ†æ] â†’ æŸ¥çœ‹ä»£ç (1) â†’ è·Ÿè¸ªè°ƒç”¨(2) â†’ å®šä½é—®é¢˜(3)
                                            â†“
                        æ­¤æ—¶è¶…è¿‡ 3 æ­¥ï¼Œè§¦å‘è‡ªåŠ¨åˆ†è£‚
                                            â†“
                        è®°å½•ç»“è®ºï¼š"å‘ç° XXX æ˜¯é—®é¢˜æ ¹æº"
                                            â†“
                        åˆ†è£‚ï¼š"ä¿®å¤ XXX é—®é¢˜"
\`\`\`

**å¼•å¯¼è¯æœ¯**ï¼š
> "ç»è¿‡åˆ†æï¼Œæˆ‘å‘ç°é—®é¢˜æ ¹æºæ˜¯ï¼š[ç»“è®ºæ‘˜è¦]
>
> å·²è®°å½•åˆ°å½“å‰èŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥åˆ›å»ºå­ä»»åŠ¡å¤„ç†ï¼š[å­ä»»åŠ¡åç§°]"
`,

  // å®Œæˆä»»åŠ¡
  "complete_task": `
## åœºæ™¯ï¼šå®Œæˆä»»åŠ¡

### å½“èŠ‚ç‚¹ä»»åŠ¡å®Œæˆæ—¶ï¼š

**æ­¥éª¤ 1ï¼šæ›´æ–°èŠ‚ç‚¹ç»“è®º**
\`\`\`typescript
node_update({
  workspaceId: "xxx",
  nodeId: "current-node",
  note: "å®é™…é‡‡ç”¨äº†ç­–ç•¥æ¨¡å¼å®ç°ï¼Œæ¯”åŸè®¡åˆ’çš„å·¥å‚æ¨¡å¼æ›´çµæ´»"
})
\`\`\`

**æ­¥éª¤ 2ï¼šè½¬æ¢çŠ¶æ€**
\`\`\`typescript
// å¦‚æœéœ€è¦éªŒè¯
node_transition({
  workspaceId: "xxx",
  nodeId: "current-node",
  action: "submit",
  reason: "ä»£ç å·²å®Œæˆï¼Œç­‰å¾…æµ‹è¯•éªŒè¯"
})

// å¦‚æœå¯ä»¥ç›´æ¥å®Œæˆ
node_transition({
  workspaceId: "xxx",
  nodeId: "current-node",
  action: "complete",
  conclusion: "æˆåŠŸå®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¡¨å•éªŒè¯å’ŒJWTè®¤è¯"
})
\`\`\`

**æ­¥éª¤ 3ï¼šæ£€æŸ¥çˆ¶èŠ‚ç‚¹**
å¦‚æœå½“å‰æ˜¯å­èŠ‚ç‚¹ï¼Œå®Œæˆååº”è¿”å›çˆ¶èŠ‚ç‚¹ç»§ç»­ã€‚

**å¼•å¯¼è¯æœ¯**ï¼š
> "è¿™ä¸ªä»»åŠ¡å·²ç»å®Œæˆäº†ï¼
>
> **å®Œæˆå†…å®¹**ï¼š[ç»“è®ºæ‘˜è¦]
>
> **äº§å‡º**ï¼š
> - [å…·ä½“äº§å‡ºåˆ—è¡¨]
>
> [å¦‚æœæœ‰çˆ¶ä»»åŠ¡] ç°åœ¨å›åˆ°ä¸Šçº§ä»»åŠ¡ç»§ç»­..."
`,

  // æŸ¥çœ‹è¿›åº¦
  "check_progress": `
## åœºæ™¯ï¼šæŸ¥çœ‹ä»»åŠ¡è¿›åº¦

### å½“ç”¨æˆ·è¯¢é—®è¿›åº¦æ—¶ï¼š

**è·å–å·¥ä½œåŒºçŠ¶æ€**
\`\`\`typescript
workspace_status({ workspaceId: "xxx", format: "markdown" })
\`\`\`

**è¾“å‡ºæ ¼å¼ç¤ºä¾‹**ï¼š
\`\`\`
## å·¥ä½œåŒºï¼šå®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½

**çŠ¶æ€**ï¼šè¿›è¡Œä¸­
**å½“å‰ç„¦ç‚¹**ï¼šåç«¯APIå®ç°

### èŠ‚ç‚¹æ ‘
\`\`\`
[â—] æ ¹èŠ‚ç‚¹ - å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½
 â”œâ”€[â—] å‰ç«¯è¡¨å• (completed)
 â”œâ”€[â—] åç«¯APIå®ç° (implementing) â† å½“å‰
 â”‚  â”œâ”€[â—] æ•°æ®åº“è®¾è®¡ (completed)
 â”‚  â””â”€[â—‹] JWTé›†æˆ (pending)
 â””â”€[â—‹] é›†æˆæµ‹è¯• (pending)
\`\`\`

**å½“å‰é—®é¢˜**ï¼šæ— 

**æœ€è¿‘æ—¥å¿—**ï¼š
- 10:30 [AI] å®Œæˆæ•°æ®åº“è¡¨è®¾è®¡
- 10:35 [AI] å¼€å§‹å®ç°ç™»å½•æ¥å£
\`\`\`
`,

  // ç”¨æˆ·ä¸ç†Ÿæ‚‰
  "user_guide": `
## åœºæ™¯ï¼šç”¨æˆ·ä¸ç†Ÿæ‚‰ TanmiWorkspace

### å½“ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨æˆ–è¯¢é—®æ—¶ï¼š

**ç®€å•ä»‹ç»**ï¼š
> "TanmiWorkspace æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬ç®¡ç†å¤æ‚ä»»åŠ¡çš„å·¥å…·ã€‚
>
> **å®ƒèƒ½åšä»€ä¹ˆ**ï¼š
> - ğŸ“‹ æŠŠå¤§ä»»åŠ¡æ‹†åˆ†æˆå°æ­¥éª¤
> - ğŸ” è¿½è¸ªæ¯ä¸ªæ­¥éª¤çš„è¿›åº¦
> - ğŸ“ è®°å½•æ‰§è¡Œè¿‡ç¨‹ï¼Œæ–¹ä¾¿å›é¡¾
> - ğŸ”„ é‡åˆ°é—®é¢˜æ—¶å¯ä»¥å›é€€å’Œé‡è¯•
>
> **åŸºæœ¬æ¦‚å¿µ**ï¼š
> - **å·¥ä½œåŒº**ï¼šä¸€ä¸ªå®Œæ•´ä»»åŠ¡çš„å®¹å™¨
> - **èŠ‚ç‚¹**ï¼šä»»åŠ¡çš„æ¯ä¸ªæ­¥éª¤
> - **çŠ¶æ€**ï¼špendingï¼ˆå¾…åšï¼‰â†’ implementingï¼ˆæ‰§è¡Œä¸­ï¼‰â†’ completedï¼ˆå®Œæˆï¼‰
>
> **ä½ åªéœ€è¦**ï¼š
> 1. å‘Šè¯‰æˆ‘ä½ è¦åšä»€ä¹ˆ
> 2. ç¡®è®¤ä»»åŠ¡è®¡åˆ’
> 3. è®©æˆ‘æ‰§è¡Œï¼Œæœ‰é—®é¢˜æ—¶æˆ‘ä¼šè¯¢é—®ä½ 
>
> éœ€è¦æˆ‘æ¼”ç¤ºä¸€ä¸‹å—ï¼Ÿ"

**æ¼”ç¤ºæµç¨‹**ï¼š
1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å·¥ä½œåŒº
2. å±•ç¤ºèŠ‚ç‚¹åˆ›å»ºå’ŒçŠ¶æ€æµè½¬
3. æ¼”ç¤ºæ—¥å¿—è®°å½•
4. åˆ é™¤ç¤ºä¾‹å·¥ä½œåŒº
`
};

/**
 * ç”¨æˆ·å¼•å¯¼è¯æœ¯æ¨¡æ¿
 */
export const USER_PROMPTS = {
  // é¦–æ¬¡ä½¿ç”¨å¼•å¯¼
  welcome: `æ¬¢è¿ä½¿ç”¨ TanmiWorkspaceï¼æˆ‘å¯ä»¥å¸®ä½ ç®¡ç†å¼€å‘ä»»åŠ¡ã€‚

ä½ å¯ä»¥ï¼š
- è¯´"å¸®æˆ‘åš XXX"å¼€å§‹ä¸€ä¸ªæ–°ä»»åŠ¡
- è¯´"ç»§ç»­ä¹‹å‰çš„ä»»åŠ¡"æ¢å¤å·¥ä½œ
- è¯´"æŸ¥çœ‹è¿›åº¦"äº†è§£å½“å‰çŠ¶æ€
- è¯´"è¿™æ˜¯ä»€ä¹ˆ"äº†è§£æ›´å¤š

æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ`,

  // ç¡®è®¤åˆ›å»ºå·¥ä½œåŒº
  confirmWorkspace: (name: string, goal: string) => `
æˆ‘æ¥ç¡®è®¤ä¸€ä¸‹ä»»åŠ¡ä¿¡æ¯ï¼š

**ä»»åŠ¡åç§°**ï¼š${name}
**ç›®æ ‡**ï¼š${goal}

ç¡®è®¤åæˆ‘ä¼šåˆ›å»ºå·¥ä½œåŒºå¹¶åˆ¶å®šæ‰§è¡Œè®¡åˆ’ã€‚å¯ä»¥ç»§ç»­å—ï¼Ÿ`,

  // ä»»åŠ¡è®¡åˆ’ç¡®è®¤
  confirmPlan: (tasks: string[]) => `
æ ¹æ®ä»»åŠ¡ç›®æ ‡ï¼Œæˆ‘åˆ¶å®šäº†ä»¥ä¸‹è®¡åˆ’ï¼š

${tasks.map((t, i) => `${i + 1}. ${t}`).join('\n')}

ç¡®è®¤åæˆ‘ä¼šå¼€å§‹æ‰§è¡Œã€‚éœ€è¦è°ƒæ•´å—ï¼Ÿ`,

  // çŠ¶æ€æŠ¥å‘Š
  statusReport: (status: string, current: string, problem?: string) => `
**å½“å‰çŠ¶æ€**ï¼š${status}
**æ­£åœ¨å¤„ç†**ï¼š${current}
${problem ? `**é‡åˆ°é—®é¢˜**ï¼š${problem}` : ''}

ç»§ç»­æ‰§è¡Œå—ï¼Ÿ`,

  // å®ŒæˆæŠ¥å‘Š
  completionReport: (conclusion: string, outputs: string[]) => `
âœ… ä»»åŠ¡å®Œæˆï¼

**ç»“è®º**ï¼š${conclusion}

**äº§å‡º**ï¼š
${outputs.map(o => `- ${o}`).join('\n')}

è¿˜æœ‰å…¶ä»–éœ€è¦å—ï¼Ÿ`
};

/**
 * tanmi_help å·¥å…·çš„å¸®åŠ©å†…å®¹
 */
export const HELP_TOPICS: Record<string, { title: string; content: string }> = {
  "overview": {
    title: "ç³»ç»Ÿæ¦‚è¿°",
    content: SYSTEM_OVERVIEW
  },
  "workflow": {
    title: "æ ¸å¿ƒå·¥ä½œæµç¨‹",
    content: CORE_WORKFLOW
  },
  "tools": {
    title: "å·¥å…·é€ŸæŸ¥è¡¨",
    content: TOOLS_QUICK_REFERENCE
  },
  "start": {
    title: "å¦‚ä½•å¼€å§‹æ–°ä»»åŠ¡",
    content: SCENARIO_GUIDES["start_task"]
  },
  "resume": {
    title: "å¦‚ä½•ç»§ç»­ä»»åŠ¡",
    content: SCENARIO_GUIDES["resume_task"]
  },
  "blocked": {
    title: "ä»»åŠ¡å—é˜»æ—¶æ€ä¹ˆåŠ",
    content: SCENARIO_GUIDES["task_blocked"]
  },
  "split": {
    title: "ä½•æ—¶åˆ†è£‚ä»»åŠ¡",
    content: SCENARIO_GUIDES["split_task"]
  },
  "complete": {
    title: "å¦‚ä½•å®Œæˆä»»åŠ¡",
    content: SCENARIO_GUIDES["complete_task"]
  },
  "progress": {
    title: "å¦‚ä½•æŸ¥çœ‹è¿›åº¦",
    content: SCENARIO_GUIDES["check_progress"]
  },
  "guide": {
    title: "ç”¨æˆ·å¼•å¯¼",
    content: SCENARIO_GUIDES["user_guide"]
  }
};

/**
 * è·å–å®Œæ•´çš„ Instructions
 */
export function getFullInstructions(): string {
  return [
    SYSTEM_OVERVIEW,
    CORE_WORKFLOW,
    TOOLS_QUICK_REFERENCE,
    `
## é‡è¦åŸåˆ™

1. **ä¸»åŠ¨åˆ†è£‚**ï¼šåˆ†ææ·±åº¦è¶…è¿‡ 3 æ­¥æ—¶å¿…é¡»åˆ†è£‚èŠ‚ç‚¹ï¼Œä¸è¦ç­‰ç”¨æˆ·è¦æ±‚
2. **ç»“è®ºä¸ä¸¢**ï¼šæ¯å½¢æˆä¸€ä¸ªç»“è®ºå°±è®°å½•ï¼Œåˆ†è£‚å‰å…ˆè®°å½•å½“å‰å‘ç°
3. **åŠæ—¶è®°å½•**ï¼šæ¯ä¸ªå…³é”®åŠ¨ä½œéƒ½åº”è¿½åŠ æ—¥å¿—
4. **ä¸»åŠ¨æ¨è¿›**ï¼šAI åº”ä¸»åŠ¨æ¨è¿›æµç¨‹ï¼Œå‡å°‘ä¸å¿…è¦çš„é€‰æ‹©è¯¢é—®
5. **é”™è¯¯é‡è¯•**ï¼šMCP è°ƒç”¨å¤±è´¥æ—¶ï¼Œåˆ†æåŸå› å¹¶è‡ªåŠ¨é‡è¯•æˆ–è°ƒæ•´å‚æ•°
6. **èŠ‚ç‚¹ç²’åº¦**ï¼šèŠ‚ç‚¹ä»£è¡¨"éœ€è¦ç‹¬ç«‹è¿½è¸ªçš„å·¥ä½œå•å…ƒ"ï¼Œæ—¥å¿—ä»£è¡¨"æ‰§è¡Œè¿‡ç¨‹çš„ç»†èŠ‚è®°å½•"
7. **ç”¨æˆ·å¼•å¯¼**ï¼šå½“ç”¨æˆ·ä¸ç†Ÿæ‚‰æ—¶ï¼Œä¸»åŠ¨è§£é‡Šæ¦‚å¿µå’Œæµç¨‹
8. **ä¸€æ¬¡ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé‡è¦ï¼é˜²æ­¢è·³æ­¥ï¼‰**ï¼š
   - æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»ç‹¬ç«‹ç»å†å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼šstart â†’ æ‰§è¡Œ â†’ complete
   - **ç¦æ­¢**ï¼šåœ¨æ‰§è¡ŒèŠ‚ç‚¹ A æ—¶"é¡ºä¾¿"å®ŒæˆèŠ‚ç‚¹ B çš„å·¥ä½œ
   - **ç¦æ­¢**ï¼šåŒæ—¶å°†å¤šä¸ªèŠ‚ç‚¹æ ‡è®°ä¸º completedï¼ˆé™¤éå®ƒä»¬ç¡®å®åŒæ—¶å®Œæˆï¼‰
   - **æ­£ç¡®åšæ³•**ï¼šå®Œæˆå½“å‰èŠ‚ç‚¹åï¼Œå† start ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¾æ¬¡å¤„ç†
   - å¦‚æœå‘ç°éœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œåº”è¯¥åˆ›å»ºä¸€ä¸ªçˆ¶èŠ‚ç‚¹æ¥ç»Ÿç­¹

## ä½¿ç”¨ tanmi_help å·¥å…·

å½“ä½ éœ€è¦æŸ¥è¯¢ç‰¹å®šåœºæ™¯çš„æŒ‡å¯¼æ—¶ï¼Œå¯ä»¥è°ƒç”¨ tanmi_help å·¥å…·ï¼š

å¯ç”¨ä¸»é¢˜ï¼š
- overview: ç³»ç»Ÿæ¦‚è¿°
- workflow: æ ¸å¿ƒå·¥ä½œæµç¨‹
- tools: å·¥å…·é€ŸæŸ¥è¡¨
- start: å¦‚ä½•å¼€å§‹æ–°ä»»åŠ¡
- resume: å¦‚ä½•ç»§ç»­ä»»åŠ¡
- blocked: ä»»åŠ¡å—é˜»æ—¶æ€ä¹ˆåŠ
- split: ä½•æ—¶åˆ†è£‚ä»»åŠ¡
- complete: å¦‚ä½•å®Œæˆä»»åŠ¡
- progress: å¦‚ä½•æŸ¥çœ‹è¿›åº¦
- guide: ç”¨æˆ·å¼•å¯¼è¯æœ¯
`
  ].join('\n\n');
}
