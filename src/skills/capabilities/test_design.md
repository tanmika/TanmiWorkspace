---
id: test_design
name: 测试设计
description: 基于需求和设计，制定测试策略和测试用例
type: summary
acceptanceCriteria:
  - when: 测试设计完成
    then: 包含测试策略、测试用例、覆盖范围
  - when: 输出测试文档
    then: 测试用例可直接执行
---

# 测试设计

## 执行步骤

1. **分析测试需求**
   - 从验收标准提取测试点
   - 识别关键功能与边界条件
   - 确定测试优先级

2. **制定测试策略**
   - 确定测试层级（单元/集成/端到端）
   - 选择测试工具与框架
   - 定义覆盖率目标

3. **设计测试用例**
   - 按 Given/When/Then 格式编写
   - 覆盖正常、异常、边界场景
   - 设计测试数据

4. **输出测试文档**
   - 整理测试用例列表
   - 标注优先级
   - 提供测试脚本示例

## 检查清单

### 测试策略
- [ ] **测试层级**：需要哪些层级的测试（单元/集成/E2E）？
- [ ] **测试工具**：使用什么测试框架/工具？
- [ ] **覆盖率目标**：期望的代码覆盖率？
- [ ] **测试环境**：需要哪些测试环境？

### 测试用例设计
- [ ] **功能覆盖**：所有功能点都有测试用例？
- [ ] **边界覆盖**：边界值、极限值都测试了？
- [ ] **异常覆盖**：错误场景都覆盖了？
- [ ] **组合覆盖**：关键组合场景都测试了？

### 测试数据
- [ ] **正常数据**：典型场景的测试数据？
- [ ] **边界数据**：边界值测试数据？
- [ ] **异常数据**：触发错误的数据？
- [ ] **Mock 数据**：需要 Mock 哪些依赖？

### 可执行性
- [ ] **前置条件**：测试前需要准备什么？
- [ ] **执行步骤**：测试步骤清晰可执行？
- [ ] **预期结果**：预期结果明确可验证？
- [ ] **清理工作**：测试后需要清理什么？

## 测试策略

### 测试金字塔
```
       /\
      /E2E\      少量端到端测试
     /------\
    /集成测试\    适量集成测试
   /----------\
  /  单元测试  \  大量单元测试
 /--------------\
```

### 测试层级定义

**单元测试（Unit Test）**
- 测试对象：单个函数/方法/类
- 测试工具：Jest, Mocha, pytest
- 覆盖目标：80%+ 代码覆盖率

**集成测试（Integration Test）**
- 测试对象：模块间协作
- 测试工具：集成测试框架
- 覆盖目标：关键接口与数据流

**端到端测试（E2E Test）**
- 测试对象：完整业务流程
- 测试工具：Playwright, Cypress
- 覆盖目标：核心用户路径

## 测试用例模板

### Given/When/Then 格式

```gherkin
Feature: [功能名称]

Scenario: [场景描述]
  Given [前置条件]
  When [触发操作]
  Then [预期结果]
```

### 示例
```gherkin
Feature: 用户登录

Scenario: 正常登录成功
  Given 用户已注册账号 "user@example.com"
  And 密码为 "Password123"
  When 用户访问登录页面
  And 输入正确的邮箱和密码
  And 点击登录按钮
  Then 应该跳转到首页
  And 显示用户昵称

Scenario: 密码错误登录失败
  Given 用户已注册账号 "user@example.com"
  When 用户输入错误密码 "WrongPass"
  And 点击登录按钮
  Then 应该显示错误提示 "密码错误"
  And 保持在登录页面
```

## 输出模板

```markdown
## 测试策略

### 测试层级
- **单元测试**：[覆盖范围、工具选择]
- **集成测试**：[覆盖范围、工具选择]
- **E2E 测试**：[覆盖范围、工具选择]

### 测试工具
- 测试框架：[Jest/Mocha/pytest/...]
- Mock 工具：[工具名称]
- 覆盖率工具：[工具名称]

### 覆盖目标
- 单元测试覆盖率：[目标百分比]
- 集成测试覆盖：[关键接口列表]
- E2E 测试覆盖：[核心流程列表]

## 测试用例

### 功能模块一：[模块名称]

#### TC01: [用例标题] (P0)
**描述**：[用例描述]

**前置条件**：
- [条件1]
- [条件2]

**测试步骤**：
1. Given [前置条件]
2. When [操作步骤]
3. Then [预期结果]

**测试数据**：
- 输入：[测试输入]
- 预期输出：[预期输出]

**优先级**：P0（高）/ P1（中）/ P2（低）

#### TC02: [用例标题] (P1)
[同上结构]

### 功能模块二：[模块名称]
[同上结构]

## 覆盖范围检查

### 功能覆盖
| 功能点 | 测试用例 | 覆盖状态 |
|--------|----------|----------|
| [功能1] | TC01, TC02 | ✅ |
| [功能2] | TC03 | ✅ |

### 边界覆盖
- [ ] 最小值/最大值
- [ ] 空值/null
- [ ] 特殊字符
- [ ] 超长输入

### 异常覆盖
- [ ] 参数错误
- [ ] 网络异常
- [ ] 权限不足
- [ ] 并发冲突

## 测试脚本示例

### 单元测试示例
\`\`\`typescript
describe('功能模块', () => {
  test('TC01: 正常场景', () => {
    // Given
    const input = {...};

    // When
    const result = functionUnderTest(input);

    // Then
    expect(result).toEqual(expected);
  });

  test('TC02: 异常场景', () => {
    // Given
    const invalidInput = {...};

    // When & Then
    expect(() => functionUnderTest(invalidInput))
      .toThrow('错误信息');
  });
});
\`\`\`

### E2E 测试示例
\`\`\`typescript
test('TC05: 用户登录流程', async ({ page }) => {
  // Given
  await page.goto('/login');

  // When
  await page.fill('[name="email"]', 'user@example.com');
  await page.fill('[name="password"]', 'Password123');
  await page.click('button[type="submit"]');

  // Then
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('.user-name')).toBeVisible();
});
\`\`\`

## 测试数据

### 正常数据
\`\`\`json
{
  "validUser": {
    "email": "user@example.com",
    "password": "Password123"
  }
}
\`\`\`

### 边界数据
\`\`\`json
{
  "minLength": "ab",
  "maxLength": "a".repeat(255)
}
\`\`\`

### 异常数据
\`\`\`json
{
  "invalidEmail": "not-an-email",
  "emptyPassword": ""
}
\`\`\`
```

## 验证规则

### 完整性检查
- 至少 10 个测试用例（根据功能复杂度调整）
- 覆盖所有验收标准
- 包含正常、异常、边界场景
- 测试数据完整

### 可执行性检查
- 每个用例都有明确步骤
- 预期结果可验证
- 前置条件可准备
- 测试脚本示例可运行

### 覆盖范围检查
- 功能覆盖率 100%
- 关键边界都测试
- 主要异常都覆盖
- 核心流程有 E2E 测试

### 完成标准
- 测试策略明确
- 测试用例完整
- 覆盖范围检查通过
- 测试方案经过评审确认
