---
id: measurement_analysis
name: 度量分析
description: 建立性能基准，测量和对比数据，验证优化效果
type: collection
acceptanceCriteria:
  - when: 性能指标已定义
    then: 明确要测量什么（FPS、内存、响应时间、Bundle体积等）
  - when: 测试环境已建立
    then: 确认测试环境和测试数据量
  - when: 基准数据已获取
    then: 执行测试并记录当前数值
  - when: 对比分析完成（Post-Check阶段）
    then: 对比优化前后数据，计算提升率
---

# 度量分析 (Measurement Analysis)

**核心思维**: 测量 (Measure)
**典型动作**: 建立基准、对比数据

## 执行步骤 (SOP)

### 1. 定义指标
确定要测什么，选择合适的性能指标。

**常见指标**:
- **前端性能**: FPS、首屏加载时间、TTI、LCP、Bundle 体积
- **API 性能**: 响应时间（P50/P95/P99）、QPS、错误率
- **系统性能**: CPU 使用率、内存占用、磁盘 I/O、网络带宽
- **业务指标**: 转化率、用户留存、操作成功率

**输出**: 明确的指标清单（含目标值）

### 2. 建立测试环境
确认测试环境配置，确保结果可复现。

**关键要素**:
- **硬件环境**: CPU、内存、磁盘规格
- **软件环境**: 操作系统、运行时版本、依赖版本
- **网络环境**: 带宽、延迟
- **数据规模**: 测试数据量、并发用户数

**输出**: 测试环境文档

### 3. 获取基准 (Baseline)
执行测试，记录当前性能数值。

**执行要点**:
- 选择合适的测试工具（wrk、k6、Lighthouse、Chrome DevTools）
- 多次测试取平均值（消除偶然误差）
- 记录完整的性能数据（不只是平均值）
- 保存原始测试日志

**输出**: 基准性能报告（Baseline Report）

### 4. 对比分析（仅在 Post-Check 阶段）
对比优化前后的数据，计算提升率。

**对比维度**:
- **绝对值对比**: 优化前 vs 优化后
- **提升率计算**: (改进值 / 原始值) × 100%
- **目标达成**: 是否达到预期目标
- **回归检测**: 是否引入新的性能问题

**输出**: 对比分析报告（含提升率）

## 检查清单

### 指标定义
- [ ] **指标选择合理**：与优化目标直接相关？
- [ ] **可测量性**：能否用工具测量？
- [ ] **目标值设定**：是否有明确的目标值？
- [ ] **优先级标注**：哪些是核心指标（P0）？

### 测试环境
- [ ] **环境一致性**：优化前后测试环境一致？
- [ ] **数据规模合理**：测试数据量是否符合实际场景？
- [ ] **并发设置**：并发用户数是否合理？
- [ ] **工具选择**：测试工具是否适合场景？

### 基准数据
- [ ] **数据完整性**：是否记录了所有关键指标？
- [ ] **多次测试**：是否进行了多次测试取平均值？
- [ ] **异常值处理**：是否排除了异常数据？
- [ ] **原始日志保存**：是否保存了原始测试日志？

### 对比分析（Post-Check）
- [ ] **对比维度完整**：是否覆盖所有关键指标？
- [ ] **提升率计算正确**：计算方法是否正确？
- [ ] **目标达成确认**：是否达到预期目标？
- [ ] **回归检测**：是否有性能回归？

## 输出模板

### 基准报告模板（Baseline Report）

```markdown
## 性能基准报告

**测试时间**: [YYYY-MM-DD HH:mm]
**测试目的**: 建立性能基准 / 验证优化效果
**测试工具**: [工具名称及版本]

### 测试环境

#### 硬件配置
- **CPU**: [型号、核心数]
- **内存**: [容量]
- **磁盘**: [类型、容量]

#### 软件配置
- **操作系统**: [OS 版本]
- **运行时**: [Node/Python/Java 版本]
- **框架**: [框架及版本]

#### 测试数据
- **数据量**: [记录数]
- **并发用户**: [用户数]

### 性能指标

| 指标 | 当前值 | 目标值 | 状态 |
|------|--------|--------|------|
| P50 响应时间 | 85ms | < 100ms | ✅ |
| P95 响应时间 | 420ms | < 500ms | ✅ |
| P99 响应时间 | 890ms | < 1000ms | ✅ |
| QPS | 1200 | > 1000 | ✅ |
| CPU 使用率 | 45% | < 60% | ✅ |
| 内存占用 | 1.2GB | < 2GB | ✅ |

### 测试结果详情

#### 响应时间分布
```
P50:  ████████░░░░░░░░░░░░  85ms
P90:  ████████████████░░░░  320ms
P95:  ████████████████████  420ms
P99:  ████████████████████  890ms
Max:  ████████████████████  1.2s
```

#### 吞吐量趋势
- **稳定状态 QPS**: 1200
- **峰值 QPS**: 1500
- **错误率**: 0.01%

### 原始数据

[附上测试工具的原始输出日志]
```

### 对比分析模板（Post-Check）

```markdown
## 性能对比分析

### 优化前后对比

| 指标 | 优化前 | 优化后 | 提升 | 状态 |
|------|--------|--------|------|------|
| P50 响应时间 | 150ms | 85ms | 43% ⬇️ | ✅ |
| P95 响应时间 | 680ms | 420ms | 38% ⬇️ | ✅ |
| QPS | 800 | 1200 | 50% ⬆️ | ✅ |
| CPU 使用率 | 72% | 45% | 37% ⬇️ | ✅ |
| 内存占用 | 1.8GB | 1.2GB | 33% ⬇️ | ✅ |

### 目标达成情况

✅ **所有核心指标均达到目标**
- P50 响应时间从 150ms 降至 85ms（目标 < 100ms）
- QPS 从 800 提升至 1200（目标 > 1000）
- CPU 使用率从 72% 降至 45%（目标 < 60%）

### 回归检测

✅ **无性能回归**
- 所有非优化指标保持稳定
- 错误率无明显变化（0.01% → 0.01%）

### 结论

优化效果显著，响应时间降低 40%+，吞吐量提升 50%，资源占用降低 30%+。
```

## 测试工具选择

### Web 应用性能测试
- **Lighthouse**: 前端性能评分（LCP、FID、CLS）
- **Chrome DevTools**: Performance 面板、Network 面板
- **WebPageTest**: 真实网络环境测试
- **Webpack Bundle Analyzer**: Bundle 体积分析

### API 性能测试
- **wrk**: 高性能 HTTP 压测（简单场景）
- **k6**: 现代化负载测试（复杂场景）
- **Apache Bench (ab)**: 简单 HTTP 压测
- **Artillery**: Node.js 性能测试

### 系统资源监控
- **htop/top**: 实时系统资源监控
- **vmstat**: 虚拟内存统计
- **iostat**: 磁盘 I/O 统计
- **Prometheus + Grafana**: 可视化监控

### 移动应用性能
- **Xcode Instruments**: iOS 性能分析
- **Android Profiler**: Android 性能分析
- **React Native Performance Monitor**: RN 性能监控

## 验证规则

### 完整性检查
- 性能指标已明确定义
- 测试环境信息完整
- 测试结果数据完整（含多次测试）
- 原始日志已保存

### 准确性检查
- 测试数据真实可信（多次测试取平均）
- 性能指标计算正确（提升率计算无误）
- 测试环境与实际场景匹配
- 异常值已排除

### 可复现性检查
- 测试脚本可执行
- 测试环境可重建
- 测试步骤明确
- 结果可验证

### 完成标准
- 性能基准已建立（Baseline 阶段）
- 对比分析已完成（Post-Check 阶段）
- 目标达成情况已确认
- 性能报告已输出
- 无性能回归（Post-Check 阶段）
