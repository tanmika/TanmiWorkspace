---
id: error_analysis
name: 错误分析
description: 系统化分析错误，定位根因并提供修复方案
type: collection
acceptanceCriteria:
  - when: 错误分析完成
    then: 定位根本原因，提供修复方案
  - when: 输出分析报告
    then: 包含错误现象、根因分析、修复建议
---

# 错误分析

## 执行步骤

1. **记录错误现象**
   - 收集错误信息（错误消息、堆栈、截图）
   - 确认复现步骤
   - 记录环境信息

2. **初步分析**
   - 阅读错误消息
   - 检查堆栈跟踪
   - 定位问题代码位置

3. **根因分析**
   - 使用 5 Whys 方法深挖
   - 分析相关代码逻辑
   - 检查数据流与状态

4. **制定修复方案**
   - 提出修复建议
   - 评估修复影响
   - 给出预防措施

5. **输出分析报告**
   - 整理分析过程
   - 标注关键发现
   - 提供可执行的修复步骤

## 检查清单

### 错误信息收集
- [ ] **错误消息**：完整错误文本？
- [ ] **堆栈跟踪**：完整调用栈？
- [ ] **错误代码**：错误码（如有）？
- [ ] **发生时间**：何时开始出现？

### 复现信息
- [ ] **复现步骤**：如何触发错误？
- [ ] **复现概率**：必现/偶现？
- [ ] **触发条件**：特定数据/环境？
- [ ] **最小复现**：最简单复现方式？

### 环境信息
- [ ] **运行环境**：操作系统、版本？
- [ ] **软件版本**：语言、框架版本？
- [ ] **依赖版本**：相关依赖版本？
- [ ] **配置信息**：相关配置项？

### 影响范围
- [ ] **影响功能**：哪些功能受影响？
- [ ] **影响用户**：哪些用户受影响？
- [ ] **严重程度**：P0/P1/P2？
- [ ] **临时方案**：有临时绕过方式吗？

## 5 Whys 根因分析法

### 分析流程
```
问题现象
  ↓ Why?
表面原因
  ↓ Why?
中间原因
  ↓ Why?
深层原因
  ↓ Why?
系统原因
  ↓ Why?
根本原因 ← 修复点
```

### 示例
```
现象：用户无法登录
  ↓ Why? 为什么无法登录？
原因1：API 返回 500 错误
  ↓ Why? 为什么返回 500？
原因2：数据库查询失败
  ↓ Why? 为什么查询失败？
原因3：连接池耗尽
  ↓ Why? 为什么连接池耗尽？
原因4：连接未正确释放
  ↓ Why? 为什么未释放？
根因：异常处理缺少 finally 块 ← 修复点
```

## 错误分类

### 语法错误（Syntax Error）
- **特征**：代码无法解析/编译
- **定位**：错误消息直接指出位置
- **修复**：修正语法错误

### 运行时错误（Runtime Error）
- **特征**：运行时抛出异常
- **定位**：堆栈跟踪定位
- **修复**：检查数据、逻辑、边界条件

### 逻辑错误（Logic Error）
- **特征**：无报错但结果不符合预期
- **定位**：需要调试、打日志
- **修复**：修正业务逻辑

### 环境错误（Environment Error）
- **特征**：本地正常，特定环境失败
- **定位**：对比环境差异
- **修复**：调整配置、依赖版本

### 并发错误（Concurrency Error）
- **特征**：偶现、难以复现
- **定位**：分析竞态条件
- **修复**：加锁、原子操作

## 输出模板

```markdown
## 错误概要
**错误标题**：[简短描述]
**严重程度**：P0（紧急）/ P1（重要）/ P2（一般）
**影响范围**：[功能、用户]
**发现时间**：[时间]

## 错误现象

### 错误信息
\`\`\`
[完整错误消息]
\`\`\`

### 堆栈跟踪
\`\`\`
[完整堆栈]
\`\`\`

### 复现步骤
1. [步骤1]
2. [步骤2]
3. [步骤3]
4. **预期结果**：[应该怎样]
5. **实际结果**：[实际怎样]

### 环境信息
- **操作系统**：[OS 版本]
- **软件版本**：[语言/框架版本]
- **依赖版本**：[关键依赖版本]
- **配置信息**：[相关配置]

## 根因分析

### 5 Whys 分析
1. **Why 1**：[为什么出现问题？]
   - 答：[表面原因]

2. **Why 2**：[为什么会有表面原因？]
   - 答：[中间原因]

3. **Why 3**：[为什么会有中间原因？]
   - 答：[深层原因]

4. **Why 4**：[为什么会有深层原因？]
   - 答：[系统原因]

5. **Why 5**：[为什么会有系统原因？]
   - 答：**[根本原因]** ← 修复点

### 问题代码定位
**文件位置**：`src/path/to/file.ts:123`

\`\`\`typescript
// 问题代码
function problematicFunction() {
  // ... 有问题的逻辑
}
\`\`\`

**问题说明**：[具体哪里有问题]

### 相关代码分析
- **调用链**：[函数调用路径]
- **数据流**：[数据如何流转到问题点]
- **状态变化**：[相关状态如何变化]

## 修复方案

### 方案一：[方案名称]（推荐）
**修复思路**：[如何修复]

**代码改动**：
\`\`\`diff
- // 旧代码
+ // 新代码
\`\`\`

**修复影响**：
- ✅ 解决根本问题
- ⚠️ 需要测试相关功能

**风险评估**：[低/中/高]
**预计工作量**：[时间估计]

### 方案二：[方案名称]（备选）
[同上结构]

## 修复步骤

1. **代码修改**
   - [ ] 修改文件：`src/path/to/file.ts`
   - [ ] 修改逻辑：[具体改动]

2. **测试验证**
   - [ ] 单元测试：[测试内容]
   - [ ] 手动测试：[测试步骤]
   - [ ] 回归测试：[相关功能]

3. **部署上线**
   - [ ] 代码审查
   - [ ] 合并代码
   - [ ] 发布版本

## 预防措施

### 短期措施
- [防止此问题再次发生的措施]

### 长期措施
- [从系统层面避免类似问题的措施]

### 监控建议
- [添加什么监控/日志]

## 临时方案（如有）
**绕过方式**：[如何临时规避]
**适用场景**：[什么情况下可用]
**注意事项**：[使用临时方案的注意事项]

## 参考资料
- [相关 Issue/PR 链接]
- [相关文档链接]
- [Stack Overflow 讨论]
```

## 调试技巧

### 日志分析
- 添加关键位置日志
- 打印变量值、状态
- 跟踪执行路径

### 断点调试
- 在问题点设置断点
- 单步执行查看状态
- 检查变量值

### 二分法定位
- 注释掉部分代码
- 逐步缩小问题范围
- 找到最小复现代码

### 对比分析
- 对比正常/异常场景
- 对比不同环境
- 对比代码版本

## 验证规则

### 完整性检查
- 错误信息完整
- 复现步骤明确
- 环境信息齐全
- 根因分析深入（至少 3 层 Why）

### 准确性检查
- 根因定位准确
- 修复方案可行
- 影响范围评估准确
- 风险评估合理

### 可操作性检查
- 修复步骤明确
- 代码改动具体
- 测试方案清晰
- 可直接执行

### 完成标准
- 根本原因已定位
- 修复方案已确定
- 修复步骤已明确
- 分析报告已输出
- 用户对方案已确认
